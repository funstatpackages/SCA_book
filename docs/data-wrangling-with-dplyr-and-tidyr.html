<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Data Wrangling with dplyr and tidyr | Statistical Computing Using R</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Data Wrangling with dplyr and tidyr | Statistical Computing Using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Data Wrangling with dplyr and tidyr | Statistical Computing Using R" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Lily Wang" />


<meta name="date" content="2021-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="r-markdown.html"/>
<link rel="next" href="advanced-programming-in-r.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i><b>1.3</b> About the Author</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> R Introduction and Preliminaries</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#the-r-environment-and-language"><i class="fa fa-check"></i><b>2.1</b> The R Environment and Language</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#r-and-statistics"><i class="fa fa-check"></i><b>2.2</b> R and Statistics</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#installing-r-and-rstudio"><i class="fa fa-check"></i><b>2.3</b> Installing R and RStudio</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#obtaining-r-and-installation"><i class="fa fa-check"></i><b>2.3.1</b> Obtaining R and installation</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#installing-rstudio"><i class="fa fa-check"></i><b>2.3.2</b> Installing RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#starting-r"><i class="fa fa-check"></i><b>2.4</b> Starting R</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#description-of-three-panels-in-user-interface"><i class="fa fa-check"></i><b>2.4.1</b> Description of three panels in user interface</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro.html"><a href="intro.html#r-help"><i class="fa fa-check"></i><b>2.4.2</b> R help</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro.html"><a href="intro.html#packages"><i class="fa fa-check"></i><b>2.4.3</b> Packages</a></li>
<li class="chapter" data-level="2.4.4" data-path="intro.html"><a href="intro.html#creating-a-project-and-setting-working-directory"><i class="fa fa-check"></i><b>2.4.4</b> Creating a project and setting working directory</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html"><i class="fa fa-check"></i><b>3</b> Simple Manipulations — Numbers and Vectors</a><ul>
<li class="chapter" data-level="3.1" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html#vectors-and-assignment"><i class="fa fa-check"></i><b>3.1</b> Vectors and Assignment</a></li>
<li class="chapter" data-level="3.2" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html#vector-arithmetic"><i class="fa fa-check"></i><b>3.2</b> Vector Arithmetic</a></li>
<li class="chapter" data-level="3.3" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html#generating-regular-sequences"><i class="fa fa-check"></i><b>3.3</b> Generating Regular Sequences</a></li>
<li class="chapter" data-level="3.4" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html#logical-vectors"><i class="fa fa-check"></i><b>3.4</b> Logical Vectors</a></li>
<li class="chapter" data-level="3.5" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html#missing-values"><i class="fa fa-check"></i><b>3.5</b> Missing values</a></li>
<li class="chapter" data-level="3.6" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html#character-vectors"><i class="fa fa-check"></i><b>3.6</b> Character Vectors</a></li>
<li class="chapter" data-level="3.7" data-path="simple-manipulations-numbers-and-vectors.html"><a href="simple-manipulations-numbers-and-vectors.html#index-vectors"><i class="fa fa-check"></i><b>3.7</b> Index Vectors</a></li>
<li class="chapter" data-level="3.8" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>3.8</b> Exercises:</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="r-objects.html"><a href="r-objects.html"><i class="fa fa-check"></i><b>4</b> R Objects</a><ul>
<li class="chapter" data-level="4.1" data-path="r-objects.html"><a href="r-objects.html#introduction-of-r-objects"><i class="fa fa-check"></i><b>4.1</b> Introduction of R Objects</a><ul>
<li class="chapter" data-level="4.1.1" data-path="r-objects.html"><a href="r-objects.html#mode-of-objects"><i class="fa fa-check"></i><b>4.1.1</b> Mode of Objects</a></li>
<li class="chapter" data-level="4.1.2" data-path="r-objects.html"><a href="r-objects.html#length-of-objects"><i class="fa fa-check"></i><b>4.1.2</b> Length of Objects</a></li>
<li class="chapter" data-level="4.1.3" data-path="r-objects.html"><a href="r-objects.html#getting-and-setting-attributes"><i class="fa fa-check"></i><b>4.1.3</b> Getting and Setting Attributes</a></li>
<li class="chapter" data-level="4.1.4" data-path="r-objects.html"><a href="r-objects.html#the-class-of-an-object"><i class="fa fa-check"></i><b>4.1.4</b> The class of an object</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="r-objects.html"><a href="r-objects.html#data-structures"><i class="fa fa-check"></i><b>4.2</b> Data Structures</a><ul>
<li class="chapter" data-level="4.2.1" data-path="r-objects.html"><a href="r-objects.html#arrays"><i class="fa fa-check"></i><b>4.2.1</b> Arrays</a></li>
<li class="chapter" data-level="4.2.2" data-path="r-objects.html"><a href="r-objects.html#lists"><i class="fa fa-check"></i><b>4.2.2</b> Lists</a></li>
<li class="chapter" data-level="4.2.3" data-path="r-objects.html"><a href="r-objects.html#data-frames"><i class="fa fa-check"></i><b>4.2.3</b> Data Frames</a></li>
<li class="chapter" data-level="4.2.4" data-path="r-objects.html"><a href="r-objects.html#frequency-tables-from-factors"><i class="fa fa-check"></i><b>4.2.4</b> Frequency Tables From Factors</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exportimport-data.html"><a href="exportimport-data.html"><i class="fa fa-check"></i><b>5</b> Export/Import Data</a><ul>
<li class="chapter" data-level="5.1" data-path="exportimport-data.html"><a href="exportimport-data.html#data-export"><i class="fa fa-check"></i><b>5.1</b> Data Export</a><ul>
<li class="chapter" data-level="5.1.1" data-path="exportimport-data.html"><a href="exportimport-data.html#rdata-files"><i class="fa fa-check"></i><b>5.1.1</b> <code>.RData</code> files</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="exportimport-data.html"><a href="exportimport-data.html#data-import"><i class="fa fa-check"></i><b>5.2</b> Data Import</a><ul>
<li class="chapter" data-level="5.2.1" data-path="exportimport-data.html"><a href="exportimport-data.html#the-load-function"><i class="fa fa-check"></i><b>5.2.1</b> The <code>load()</code> function</a></li>
<li class="chapter" data-level="5.2.2" data-path="exportimport-data.html"><a href="exportimport-data.html#the-read.table-function"><i class="fa fa-check"></i><b>5.2.2</b> The <code>read.table()</code> function</a></li>
<li class="chapter" data-level="5.2.3" data-path="exportimport-data.html"><a href="exportimport-data.html#the-scan-function"><i class="fa fa-check"></i><b>5.2.3</b> The <code>scan()</code> function</a></li>
<li class="chapter" data-level="5.2.4" data-path="exportimport-data.html"><a href="exportimport-data.html#the-read.csv-function"><i class="fa fa-check"></i><b>5.2.4</b> The <code>read.csv()</code> function</a></li>
<li class="chapter" data-level="5.2.5" data-path="exportimport-data.html"><a href="exportimport-data.html#import-an-excel-file-into-r"><i class="fa fa-check"></i><b>5.2.5</b> Import an Excel file into R</a></li>
<li class="chapter" data-level="5.2.6" data-path="exportimport-data.html"><a href="exportimport-data.html#accessing-built-in-datasets"><i class="fa fa-check"></i><b>5.2.6</b> Accessing built-in datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>6</b> Visualization</a><ul>
<li class="chapter" data-level="6.1" data-path="visualization.html"><a href="visualization.html#bar-chart"><i class="fa fa-check"></i><b>6.1</b> Bar Chart</a></li>
<li class="chapter" data-level="6.2" data-path="visualization.html"><a href="visualization.html#pie-charts"><i class="fa fa-check"></i><b>6.2</b> Pie charts</a></li>
<li class="chapter" data-level="6.3" data-path="visualization.html"><a href="visualization.html#stem-and-leaf-charts"><i class="fa fa-check"></i><b>6.3</b> Stem-and-leaf Charts</a></li>
<li class="chapter" data-level="6.4" data-path="visualization.html"><a href="visualization.html#histograms"><i class="fa fa-check"></i><b>6.4</b> Histograms</a></li>
<li class="chapter" data-level="6.5" data-path="visualization.html"><a href="visualization.html#boxplot"><i class="fa fa-check"></i><b>6.5</b> Boxplot</a><ul>
<li class="chapter" data-level="6.5.1" data-path="visualization.html"><a href="visualization.html#boxplot-one-sample"><i class="fa fa-check"></i><b>6.5.1</b> Boxplot: one sample</a></li>
<li class="chapter" data-level="6.5.2" data-path="visualization.html"><a href="visualization.html#plotting-several-samples"><i class="fa fa-check"></i><b>6.5.2</b> Plotting several samples</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="visualization.html"><a href="visualization.html#scatterplot"><i class="fa fa-check"></i><b>6.6</b> Scatterplot</a><ul>
<li class="chapter" data-level="6.6.1" data-path="visualization.html"><a href="visualization.html#basic-command"><i class="fa fa-check"></i><b>6.6.1</b> Basic command</a></li>
<li class="chapter" data-level="6.6.2" data-path="visualization.html"><a href="visualization.html#more-useful-commands"><i class="fa fa-check"></i><b>6.6.2</b> More useful commands</a></li>
<li class="chapter" data-level="6.6.3" data-path="visualization.html"><a href="visualization.html#an-example-with-multiple-symbols"><i class="fa fa-check"></i><b>6.6.3</b> An example with multiple symbols</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="visualization.html"><a href="visualization.html#line-plots-and-time-series-plots"><i class="fa fa-check"></i><b>6.7</b> Line plots and Time series plots</a><ul>
<li class="chapter" data-level="6.7.1" data-path="visualization.html"><a href="visualization.html#plot-types"><i class="fa fa-check"></i><b>6.7.1</b> Plot types</a></li>
<li class="chapter" data-level="6.7.2" data-path="visualization.html"><a href="visualization.html#time-series"><i class="fa fa-check"></i><b>6.7.2</b> Time Series</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="visualization.html"><a href="visualization.html#visualization-using-ggplot2"><i class="fa fa-check"></i><b>6.8</b> Visualization using <code>ggplot2</code></a><ul>
<li class="chapter" data-level="6.8.1" data-path="visualization.html"><a href="visualization.html#scatter-plots"><i class="fa fa-check"></i><b>6.8.1</b> Scatter plots</a></li>
<li class="chapter" data-level="6.8.2" data-path="visualization.html"><a href="visualization.html#creating-maps-with-ggplot2"><i class="fa fa-check"></i><b>6.8.2</b> Creating maps with <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>6.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>7</b> R Markdown</a><ul>
<li class="chapter" data-level="7.1" data-path="r-markdown.html"><a href="r-markdown.html#getting-started-with-r-markdown"><i class="fa fa-check"></i><b>7.1</b> Getting Started with R Markdown</a></li>
<li class="chapter" data-level="7.2" data-path="r-markdown.html"><a href="r-markdown.html#formatting-your-document"><i class="fa fa-check"></i><b>7.2</b> Formatting Your Document</a></li>
<li class="chapter" data-level="7.3" data-path="r-markdown.html"><a href="r-markdown.html#text-formatting"><i class="fa fa-check"></i><b>7.3</b> Text Formatting</a></li>
<li class="chapter" data-level="7.4" data-path="r-markdown.html"><a href="r-markdown.html#greek-alphabet"><i class="fa fa-check"></i><b>7.4</b> Greek Alphabet</a></li>
<li class="chapter" data-level="7.5" data-path="r-markdown.html"><a href="r-markdown.html#r-code-chunks-and-inline-r-code"><i class="fa fa-check"></i><b>7.5</b> R code chunks and inline R code</a></li>
<li class="chapter" data-level="7.6" data-path="r-markdown.html"><a href="r-markdown.html#including-plots-and-adding-captions"><i class="fa fa-check"></i><b>7.6</b> Including Plots and Adding Captions</a></li>
<li class="chapter" data-level="7.7" data-path="r-markdown.html"><a href="r-markdown.html#modifying-figures"><i class="fa fa-check"></i><b>7.7</b> Modifying Figures</a></li>
<li class="chapter" data-level="7.8" data-path="r-markdown.html"><a href="r-markdown.html#displaying-data-with-kable"><i class="fa fa-check"></i><b>7.8</b> Displaying Data with kable</a></li>
<li class="chapter" data-level="7.9" data-path="r-markdown.html"><a href="r-markdown.html#compiling-r-markdown-documents"><i class="fa fa-check"></i><b>7.9</b> Compiling R Markdown Documents</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html"><i class="fa fa-check"></i><b>8</b> Data Wrangling with <code>dplyr</code> and <code>tidyr</code></a><ul>
<li class="chapter" data-level="8.1" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#learning-dplyr"><i class="fa fa-check"></i><b>8.1</b> Learning <code>dplyr</code></a></li>
<li class="chapter" data-level="8.2" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#selecting-columns-and-filtering-rows"><i class="fa fa-check"></i><b>8.2</b> Selecting columns and filtering rows</a></li>
<li class="chapter" data-level="8.3" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#pipes"><i class="fa fa-check"></i><b>8.3</b> Pipes</a></li>
<li class="chapter" data-level="8.4" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#select-and-order-top-n-entries-by-group-if-grouped-data."><i class="fa fa-check"></i><b>8.4</b> Select and order top n entries (by group if grouped data).</a></li>
<li class="chapter" data-level="8.5" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#mutate"><i class="fa fa-check"></i><b>8.5</b> Mutate</a></li>
<li class="chapter" data-level="8.6" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#split-apply-combine-data-analysis-and-the-summarize-function"><i class="fa fa-check"></i><b>8.6</b> Split-apply-combine data analysis and the <code>summarize()</code> function</a></li>
<li class="chapter" data-level="8.7" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#joins-with-dplyr"><i class="fa fa-check"></i><b>8.7</b> Joins with <code>dplyr</code></a></li>
<li class="chapter" data-level="8.8" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#reshaping-data---change-the-layout-of-a-data-set"><i class="fa fa-check"></i><b>8.8</b> Reshaping Data - Change the layout of a data set</a><ul>
<li class="chapter" data-level="8.8.1" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#from-wide-to-long"><i class="fa fa-check"></i><b>8.8.1</b> From wide to long</a></li>
<li class="chapter" data-level="8.8.2" data-path="data-wrangling-with-dplyr-and-tidyr.html"><a href="data-wrangling-with-dplyr-and-tidyr.html#from-long-to-wide"><i class="fa fa-check"></i><b>8.8.2</b> From long to wide</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>8.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html"><i class="fa fa-check"></i><b>9</b> Advanced Programming in R</a><ul>
<li class="chapter" data-level="9.1" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#grouped-expressions"><i class="fa fa-check"></i><b>9.1</b> Grouped expressions</a></li>
<li class="chapter" data-level="9.2" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#conditional-execution-if-statements"><i class="fa fa-check"></i><b>9.2</b> Conditional execution: <code>if</code> statements</a><ul>
<li class="chapter" data-level="9.2.1" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#iterations"><i class="fa fa-check"></i><b>9.2.1</b> Iterations</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#writing-functions"><i class="fa fa-check"></i><b>9.3</b> Writing Functions</a><ul>
<li class="chapter" data-level="9.3.1" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#simple-examples"><i class="fa fa-check"></i><b>9.3.1</b> Simple examples</a></li>
<li class="chapter" data-level="9.3.2" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#named-arguments-and-defaults"><i class="fa fa-check"></i><b>9.3.2</b> Named arguments and defaults</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#lexical-vs.-dynamic-scoping"><i class="fa fa-check"></i><b>9.4</b> Lexical vs. Dynamic Scoping</a><ul>
<li class="chapter" data-level="9.4.1" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#scoping-rules"><i class="fa fa-check"></i><b>9.4.1</b> Scoping rules</a></li>
<li class="chapter" data-level="9.4.2" data-path="advanced-programming-in-r.html"><a href="advanced-programming-in-r.html#an-environment"><i class="fa fa-check"></i><b>9.4.2</b> An Environment</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="simulations.html"><a href="simulations.html"><i class="fa fa-check"></i><b>10</b> Simulations</a><ul>
<li class="chapter" data-level="10.1" data-path="simulations.html"><a href="simulations.html#probability-distributions-and-generating-random-variables"><i class="fa fa-check"></i><b>10.1</b> Probability Distributions and Generating Random Variables</a></li>
<li class="chapter" data-level="10.2" data-path="simulations.html"><a href="simulations.html#more-examples"><i class="fa fa-check"></i><b>10.2</b> More Examples</a></li>
<li class="chapter" data-level="10.3" data-path="simulations.html"><a href="simulations.html#setting-random-number-seed"><i class="fa fa-check"></i><b>10.3</b> Setting Random Number Seed</a></li>
<li class="chapter" data-level="10.4" data-path="simulations.html"><a href="simulations.html#example-normal-approximation-to-the-binomials"><i class="fa fa-check"></i><b>10.4</b> Example: Normal Approximation to the Binomials</a></li>
<li class="chapter" data-level="10.5" data-path="simulations.html"><a href="simulations.html#random-sampling-using-sample"><i class="fa fa-check"></i><b>10.5</b> Random Sampling using <code>sample</code></a></li>
<li class="chapter" data-level="10.6" data-path="simulations.html"><a href="simulations.html#a-simulation-example"><i class="fa fa-check"></i><b>10.6</b> A Simulation Example</a></li>
<li class="chapter" data-level="10.7" data-path="simulations.html"><a href="simulations.html#basics-of-simulation"><i class="fa fa-check"></i><b>10.7</b> Basics of Simulation</a><ul>
<li class="chapter" data-level="10.7.1" data-path="simulations.html"><a href="simulations.html#repetition"><i class="fa fa-check"></i><b>10.7.1</b> Repetition</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>10.8</b> Exercises</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Computing Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-wrangling-with-dplyr-and-tidyr" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Data Wrangling with <code>dplyr</code> and <code>tidyr</code></h1>
<p>The package <code>dplyr</code> is an R package for making tabular data wrangling easier by using a limited set of functions that can be combined to extract and summarize insights from your data. It pairs nicely with the package <code>tidyr</code>, enabling you to swiftly convert between different data formats (long vs. wide) for plotting and analysis.</p>
<p><code>dplyr</code> is built to work directly with dataframes, with many common tasks optimized by being written in a compiled language (C++) (not all R packages are written in R!).</p>
<p>The package <code>tidyr</code> addresses the common problem of reshaping your data for plotting and use by different R functions. Sometimes we want data sets where we have one row per measurement. Sometimes we want a dataframe where each measurement type has its own column, and rows are instead more aggregated groups. Moving back and forth between these formats is nontrivial, and <code>tidyr</code> gives you tools for this and more sophisticated data wrangling.</p>
<div id="learning-dplyr" class="section level2">
<h2><span class="header-section-number">8.1</span> Learning <code>dplyr</code></h2>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb225-1"></a><span class="co"># Load the tidyverse</span></span>
<span id="cb225-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb225-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb225-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb225-3"></a><span class="kw">library</span>(dplyr)</span></code></pre></div>
<p>Below we will work on COVID-19 county level infected count data, and we can obtain the data from Github R package <code>slid</code>.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-1"></a><span class="co"># Install the slid package from github</span></span>
<span id="cb226-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-2"></a><span class="co"># library(devtools)</span></span>
<span id="cb226-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-3"></a><span class="co"># devtools::install_github(&#39;covid19-dashboard-us/slid&#39;)</span></span>
<span id="cb226-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-4"></a><span class="co"># Load objects in I.county into my workspace</span></span>
<span id="cb226-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-5"></a><span class="kw">library</span>(slid)</span>
<span id="cb226-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-6"></a><span class="kw">data</span>(I.county)</span>
<span id="cb226-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-7"></a></span>
<span id="cb226-8"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-8"></a><span class="co"># preview the data</span></span>
<span id="cb226-9"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb226-9"></a><span class="co"># View(I.county)</span></span></code></pre></div>
<p>We’re going to learn some of the most common <code>dplyr</code> functions:</p>
<ul>
<li><code>select()</code>: subset columns</li>
<li><code>filter()</code>: subset rows on conditions</li>
<li><code>mutate()</code>: create new columns by using information from other columns</li>
<li><code>group_by()</code> and <code>summarize()</code>: create summary statistics on grouped data</li>
<li><code>arrange()</code>: sort results</li>
<li><code>count()</code>: count discrete values</li>
</ul>
</div>
<div id="selecting-columns-and-filtering-rows" class="section level2">
<h2><span class="header-section-number">8.2</span> Selecting columns and filtering rows</h2>
<ol style="list-style-type: decimal">
<li>To select columns of a dataframe, use <code>select()</code>. The first argument to this function is the dataframe (<code>I.county</code>), and the subsequent arguments are the columns to keep, separated by commas. Alternatively, if you are selecting columns adjacent to each other, you can use a <code>:</code> to select a range of columns, read as “select columns from __ to __.”</li>
</ol>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb227-1"></a><span class="co"># load the tidyverse</span></span>
<span id="cb227-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb227-2"></a>dplyr<span class="op">::</span><span class="kw">select</span>(I.county, ID, County, State)</span>
<span id="cb227-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb227-3"></a><span class="co"># to select a series of connected columns</span></span>
<span id="cb227-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb227-4"></a>dplyr<span class="op">::</span><span class="kw">select</span>(I.county, ID, County, State, </span>
<span id="cb227-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb227-5"></a>              X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To choose rows based on specific criteria, we can use the <code>filter()</code> function. The arguments after the dataframe are the condition(s) we want for our final dataframe to adhere to (e.g. <code>State</code> name is “Iowa”). We can chain a series of conditions together using commas between each condition.</li>
</ol>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb228-1"></a><span class="co"># all Iowa counties</span></span>
<span id="cb228-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb228-2"></a>dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Here is an example of <code>filter()</code> function with multiple conditions:</li>
</ol>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb229-1"></a><span class="co"># multiple conditions: all Iowa counties with cumulative </span></span>
<span id="cb229-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb229-2"></a><span class="co"># infection count &gt; 10000</span></span>
<span id="cb229-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb229-3"></a>dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>, </span>
<span id="cb229-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb229-4"></a>              X2020.<span class="fl">12.11</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">10000</span>)</span></code></pre></div>
<p>Figure <a href="data-wrangling-with-dplyr-and-tidyr.html#fig:logic">8.1</a> shows some commonly used R logic omparisons</p>
<div class="figure" style="text-align: center"><span id="fig:logic"></span>
<img src="figures/logic.png" alt="Some commonly used logic comparisons." width="75%" />
<p class="caption">
Figure 8.1: Some commonly used logic comparisons.
</p>
</div>
</div>
<div id="pipes" class="section level2">
<h2><span class="header-section-number">8.3</span> Pipes</h2>
<p>What if you want to select and filter at the same time? There are three ways to do this: use intermediate steps, nested functions, or pipes.</p>
<p>With intermediate steps, you create a temporary dataframe and use that as input to the next function, like this:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb230-1"></a>Iowa.I.county &lt;-<span class="st"> </span></span>
<span id="cb230-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb230-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>)</span>
<span id="cb230-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb230-3"></a>Iowa.I.county.DEC &lt;-<span class="st"> </span></span>
<span id="cb230-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb230-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Iowa.I.county, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
<p>This is readable, but can clutter up your workspace with lots of objects that you have to name individually. With multiple steps, that can be hard to keep track of.</p>
<p>You can also nest functions (i.e. one function inside of another), like this:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb231-1"></a>Iowa.I.county.DEC &lt;-<span class="st"> </span></span>
<span id="cb231-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb231-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>), </span>
<span id="cb231-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb231-3"></a>                ID, County, State, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
<p>This is handy but can be difficult to read if too many functions are nested, as R evaluates the expression from the inside out (in this case, filtering, then selecting).</p>
<p>The last option, <strong>pipes</strong>, are a recent addition to R. <strong>Pipes</strong> let you take the output of one function and send it directly to the next, which is useful when you need to do many things to the same dataset. Pipes in R look like <code>%&gt;%</code> and are made available via the <code>magrittr</code> package, installed automatically with <code>dplyr</code>.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb232-1"></a>I.county <span class="op">%&gt;%</span></span>
<span id="cb232-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb232-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb232-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb232-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
<p>In the above code, we use the <strong>pipe</strong> to send the interviews dataset first through <code>filter()</code> to keep rows for the state of Iowa, then through <code>select()</code> to keep only the count in December. Since <code>%&gt;%</code> takes the object on its left and passes it as the first argument to the function on its right, we don’t need to explicitly include the <code>dataframe</code> as an argument to the <code>filter()</code> and <code>select()</code> functions anymore.</p>
<p>Some may find it helpful to read the pipe like the word “then”. For instance, in the above example, we take the dataframe <code>I.county</code>, then we filter for rows with <code>State == "Iowa"</code>, then we select columns from <code>X2020.12.11</code> to <code>X2020.12.01</code>. The <code>dplyr</code> functions are somewhat simple, but by combining them into linear workflows with the pipe, we can accomplish more complex data wrangling operations.</p>
<p>If we want to create a new object with this smaller version of the data, we can assign it a new name:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb233-1"></a>Iowa.I.county.DEC &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb233-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb233-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb233-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb233-3"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span>
<span id="cb233-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb233-4"></a></span>
<span id="cb233-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb233-5"></a><span class="kw">head</span>(Iowa.I.county.DEC)</span></code></pre></div>
<pre><code>##      ID    County X2020.12.11 X2020.12.10 X2020.12.09
## 1 19001     Adair         506         503         499
## 2 19003     Adams         208         206         200
## 3 19005 Allamakee         995         990         971
## 4 19007 Appanoose         868         862         858
## 5 19009   Audubon         326         323         321
## 6 19011    Benton        1852        1847        1826
##   X2020.12.08 X2020.12.07 X2020.12.06 X2020.12.05
## 1         489         484         484         479
## 2         196         196         195         193
## 3         954         939         925         922
## 4         853         849         843         839
## 5         315         314         313         312
## 6        1819        1798        1789        1778
##   X2020.12.04 X2020.12.03 X2020.12.02 X2020.12.01
## 1         472         453         448         444
## 2         188         181         179         171
## 3         912         884         870         850
## 4         834         816         807         804
## 5         312         311         305         301
## 6        1769        1754        1740        1728</code></pre>
</div>
<div id="select-and-order-top-n-entries-by-group-if-grouped-data." class="section level2">
<h2><span class="header-section-number">8.4</span> Select and order top n entries (by group if grouped data).</h2>
<p>The function <code>top_n</code> can be used to select top (or bottom) n rows (by value).</p>
<p>This is a convenient wrapper that uses <code>filter()</code>and <code>min_rank()</code> to select the top or bottom entries in each group, ordered by <code>wt</code>.</p>
<p>** Usage **</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb235-1"></a><span class="kw">top_n</span>(x, n, wt)</span></code></pre></div>
<p>** Arguments **
* <code>x</code>: a tbl() to filter
* <code>n</code>: number of rows to return. If <code>x</code> is grouped, this is the number of rows per group. Will include more than <code>n</code> rows if there are ties. If <code>n</code> is positive, selects the top <code>n</code> rows. If negative, selects the bottom <code>n</code> rows.
* wt (Optional). The variable to use for ordering. If not specified, defaults to the last variable in the tbl.</p>
<p>This argument is automatically quoted and later evaluated in the context of the data frame. It supports unquoting.</p>
<p>Let us find the top ten counties with the largest cumulative infected count on December 11, 2020.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb236-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb236-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb236-2"></a>I.county.top10 &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb236-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb236-3"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>, <span class="dt">wt =</span> X2020.<span class="fl">12.11</span>)</span>
<span id="cb236-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb236-4"></a>I.county.top10<span class="op">$</span>County</span></code></pre></div>
<pre><code>##  [1] Maricopa      LosAngeles    SanBernardino Broward      
##  [5] Miami-Dade    Cook          Clark         Dallas       
##  [9] Harris        Tarrant      
## 1839 Levels: Abbeville AcadiaParish Accomack Ada ... obrien</code></pre>
<p>Let us find the top ten counties with the smallest cumulative infected count on December 11, 2020.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb238-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb238-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb238-2"></a>I.county.bottom10 &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb238-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb238-3"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dt">wt =</span> X2020.<span class="fl">12.11</span>)</span>
<span id="cb238-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb238-4"></a>I.county.bottom10<span class="op">$</span>County</span></code></pre></div>
<pre><code>##  [1] Dukes        Nantucket    OglalaLakota Beaver      
##  [5] BoxElder     Cache        Carbon       Daggett     
##  [9] Duchesne     Emery        Garfield     Grand       
## [13] Iron         Juab         Kane         Millard     
## [17] Morgan       Piute        Rich         Sanpete     
## [21] Sevier       Uintah       Washington   Wayne       
## [25] Weber       
## 1839 Levels: Abbeville AcadiaParish Accomack Ada ... obrien</code></pre>
<p>Let us find the county with the largest cumulative infected count on December 11, 2020 for each state.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb240-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb240-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb240-2"></a>I.county.top1 &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb240-3"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb240-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb240-4"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, <span class="dt">wt =</span> X2020.<span class="fl">12.11</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb240-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(State, County)</span></code></pre></div>
</div>
<div id="mutate" class="section level2">
<h2><span class="header-section-number">8.5</span> Mutate</h2>
<p>Frequently you’ll want to create new columns based on the values in existing columns, for example, to obtain the number of daily new cases based on the cumulative count. For this, we’ll use <code>mutate()</code>.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb241-1"></a>I.county.new &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb241-2"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb241-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb241-3"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.10</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb241-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb241-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Y2020.12.11 =</span> X2020.<span class="fl">12.11</span> <span class="op">-</span><span class="st"> </span>X2020.<span class="fl">12.10</span>)</span>
<span id="cb241-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb241-5"></a></span>
<span id="cb241-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb241-6"></a><span class="kw">head</span>(I.county.new)</span></code></pre></div>
<pre><code>##      ID    County X2020.12.11 X2020.12.10 Y2020.12.11
## 1 19001     Adair         506         503           3
## 2 19003     Adams         208         206           2
## 3 19005 Allamakee         995         990           5
## 4 19007 Appanoose         868         862           6
## 5 19009   Audubon         326         323           3
## 6 19011    Benton        1852        1847           5</code></pre>
<p>If we want to obtain the number of daily new cases based on the cumulative count for the dates in December only, we can try the following:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-1"></a>I.county.Iowa &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb243-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>)</span>
<span id="cb243-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-3"></a></span>
<span id="cb243-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-4"></a>I.county.tmp =<span class="st"> </span>I.county.Iowa[, <span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)]</span>
<span id="cb243-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-5"></a>I.county.Iowa.new =<span class="st"> </span>I.county.Iowa</span>
<span id="cb243-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-6"></a>I.county.Iowa.new[, <span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)] =<span class="st"> </span></span>
<span id="cb243-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-7"></a><span class="st">  </span>I.county.tmp <span class="op">-</span><span class="st"> </span><span class="kw">cbind</span>(I.county.tmp[, <span class="dv">-1</span>], <span class="dv">0</span>)</span>
<span id="cb243-8"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-8"></a></span>
<span id="cb243-9"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-9"></a>I.county.Iowa.DEC =<span class="st"> </span>I.county.Iowa.new <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb243-10"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-10"></a>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)  </span>
<span id="cb243-11"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-11"></a></span>
<span id="cb243-12"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-12"></a>name.tmp =<span class="st"> </span><span class="kw">substring</span>(<span class="kw">names</span>(I.county.Iowa.DEC)[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)], <span class="dv">2</span>)</span>
<span id="cb243-13"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-13"></a><span class="kw">names</span>(I.county.Iowa.DEC)[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)] =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Y&quot;</span>, name.tmp)</span>
<span id="cb243-14"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb243-14"></a><span class="kw">head</span>(I.county.Iowa.DEC)</span></code></pre></div>
<pre><code>##      ID    County Y2020.12.11 Y2020.12.10 Y2020.12.09
## 1 19001     Adair           3           4          10
## 2 19003     Adams           2           6           4
## 3 19005 Allamakee           5          19          17
## 4 19007 Appanoose           6           4           5
## 5 19009   Audubon           3           2           6
## 6 19011    Benton           5          21           7
##   Y2020.12.08 Y2020.12.07 Y2020.12.06 Y2020.12.05
## 1           5           0           5           7
## 2           0           1           2           5
## 3          15          14           3          10
## 4           4           6           4           5
## 5           1           1           1           0
## 6          21           9          11           9
##   Y2020.12.04 Y2020.12.03 Y2020.12.02 Y2020.12.01
## 1          19           5           4           3
## 2           7           2           8           0
## 3          28          14          20          22
## 4          18           9           3           5
## 5           1           6           4           1
## 6          15          14          12          10</code></pre>
</div>
<div id="split-apply-combine-data-analysis-and-the-summarize-function" class="section level2">
<h2><span class="header-section-number">8.6</span> Split-apply-combine data analysis and the <code>summarize()</code> function</h2>
<p>Many data analysis tasks can be approached using the split-apply-combine paradigm: split the data into groups, apply some analysis to each group, and then combine the results. <code>dplyr</code> makes this very easy via the <code>group_by()</code> function.</p>
<p><strong>The <code>summarize()</code> function</strong></p>
<p><code>Summarize</code> uses summary functions, functions that take a vector of values and return a single value, such as:</p>
<ul>
<li><code>dplyr::first</code>: First value of a vector.</li>
<li><code>dplyr::last</code>: Last value of a vector.</li>
<li><code>dplyr::nth</code>: Nth value of a vector.</li>
<li><code>dplyr::n</code>: # of values in a vector.</li>
<li><code>dplyr::n_distinct</code>: # of distinct values in a vector.</li>
<li><code>IQR</code>: IQR of a vector.</li>
<li><code>min</code>: Minimum value in a vector.</li>
<li><code>max</code>: Maximum value in a vector.</li>
<li><code>mean</code>: Mean value of a vector.</li>
<li><code>median</code>: Median value of a vector.</li>
<li><code>var</code>: Variance of a vector.</li>
<li><code>sd</code>: Standard deviation of a vector.</li>
</ul>
<p><code>group_by()</code> is often used together with <code>summarize()</code>, which collapses each group into a single-row summary of that group. <code>group_by()</code> takes as arguments the column names that contain the categorical variables for which you want to calculate the summary statistics. Once the data are grouped, you can also summarize multiple variables simultaneously (and not necessarily on the same variable). So to compute the state level infected count by <code>State</code>:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb245-1"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb245-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb245-2"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb245-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb245-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>, </span>
<span id="cb245-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb245-4"></a>                   <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb247-1"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 326
##   State X2020.12.11 X2020.12.10 X2020.12.09 X2020.12.08
##   &lt;fct&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Alab…      288775      284922      280187      276665
## 2 Ariz…      394512      387529      382601      378157
## # … with 321 more variables: X2020.12.07 &lt;int&gt;,
## #   X2020.12.06 &lt;int&gt;, X2020.12.05 &lt;int&gt;,
## #   X2020.12.04 &lt;int&gt;, X2020.12.03 &lt;int&gt;,
## #   X2020.12.02 &lt;int&gt;, X2020.12.01 &lt;int&gt;,
## #   X2020.11.30 &lt;int&gt;, X2020.11.29 &lt;int&gt;,
## #   X2020.11.28 &lt;int&gt;, X2020.11.27 &lt;int&gt;,
## #   X2020.11.26 &lt;int&gt;, X2020.11.25 &lt;int&gt;,
## #   X2020.11.24 &lt;int&gt;, X2020.11.23 &lt;int&gt;,
## #   X2020.11.22 &lt;int&gt;, X2020.11.21 &lt;int&gt;,
## #   X2020.11.20 &lt;int&gt;, X2020.11.19 &lt;int&gt;,
## #   X2020.11.18 &lt;int&gt;, X2020.11.17 &lt;int&gt;,
## #   X2020.11.16 &lt;int&gt;, X2020.11.15 &lt;int&gt;,
## #   X2020.11.14 &lt;int&gt;, X2020.11.13 &lt;int&gt;,
## #   X2020.11.12 &lt;int&gt;, X2020.11.11 &lt;int&gt;,
## #   X2020.11.10 &lt;int&gt;, X2020.11.09 &lt;int&gt;,
## #   X2020.11.08 &lt;int&gt;, X2020.11.07 &lt;int&gt;,
## #   X2020.11.06 &lt;int&gt;, X2020.11.05 &lt;int&gt;,
## #   X2020.11.04 &lt;int&gt;, X2020.11.03 &lt;int&gt;,
## #   X2020.11.02 &lt;int&gt;, X2020.11.01 &lt;int&gt;,
## #   X2020.10.31 &lt;int&gt;, X2020.10.30 &lt;int&gt;,
## #   X2020.10.29 &lt;int&gt;, X2020.10.28 &lt;int&gt;,
## #   X2020.10.27 &lt;int&gt;, X2020.10.26 &lt;int&gt;,
## #   X2020.10.25 &lt;int&gt;, X2020.10.24 &lt;int&gt;,
## #   X2020.10.23 &lt;int&gt;, X2020.10.22 &lt;int&gt;,
## #   X2020.10.21 &lt;int&gt;, X2020.10.20 &lt;int&gt;,
## #   X2020.10.19 &lt;int&gt;, X2020.10.18 &lt;int&gt;,
## #   X2020.10.17 &lt;int&gt;, X2020.10.16 &lt;int&gt;,
## #   X2020.10.15 &lt;int&gt;, X2020.10.14 &lt;int&gt;,
## #   X2020.10.13 &lt;int&gt;, X2020.10.12 &lt;int&gt;,
## #   X2020.10.11 &lt;int&gt;, X2020.10.10 &lt;int&gt;,
## #   X2020.10.09 &lt;int&gt;, X2020.10.08 &lt;int&gt;,
## #   X2020.10.07 &lt;int&gt;, X2020.10.06 &lt;int&gt;,
## #   X2020.10.05 &lt;int&gt;, X2020.10.04 &lt;int&gt;,
## #   X2020.10.03 &lt;int&gt;, X2020.10.02 &lt;int&gt;,
## #   X2020.10.01 &lt;int&gt;, X2020.09.30 &lt;int&gt;,
## #   X2020.09.29 &lt;int&gt;, X2020.09.28 &lt;int&gt;,
## #   X2020.09.27 &lt;int&gt;, X2020.09.26 &lt;int&gt;,
## #   X2020.09.25 &lt;int&gt;, X2020.09.24 &lt;int&gt;,
## #   X2020.09.23 &lt;int&gt;, X2020.09.22 &lt;int&gt;,
## #   X2020.09.21 &lt;int&gt;, X2020.09.20 &lt;int&gt;,
## #   X2020.09.19 &lt;int&gt;, X2020.09.18 &lt;int&gt;,
## #   X2020.09.17 &lt;int&gt;, X2020.09.16 &lt;int&gt;,
## #   X2020.09.15 &lt;int&gt;, X2020.09.14 &lt;int&gt;,
## #   X2020.09.13 &lt;int&gt;, X2020.09.12 &lt;int&gt;,
## #   X2020.09.11 &lt;int&gt;, X2020.09.10 &lt;int&gt;,
## #   X2020.09.09 &lt;int&gt;, X2020.09.08 &lt;int&gt;,
## #   X2020.09.07 &lt;int&gt;, X2020.09.06 &lt;int&gt;,
## #   X2020.09.05 &lt;int&gt;, X2020.09.04 &lt;int&gt;,
## #   X2020.09.03 &lt;int&gt;, X2020.09.02 &lt;int&gt;,
## #   X2020.09.01 &lt;int&gt;, X2020.08.31 &lt;int&gt;,
## #   X2020.08.30 &lt;int&gt;, …</code></pre>
<p>or we can use <code>summarise_at()</code>, which affects variables selected with a character vector or <code>vars()</code>:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb249-1"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb249-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb249-2"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb249-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb249-3"></a><span class="st">  </span><span class="kw">summarize_at</span>(<span class="kw">vars</span>(X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>), </span>
<span id="cb249-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb249-4"></a>               <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb249-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb249-5"></a></span>
<span id="cb249-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb249-6"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 326
##   State X2020.12.11 X2020.12.10 X2020.12.09 X2020.12.08
##   &lt;fct&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Alab…      288775      284922      280187      276665
## 2 Ariz…      394512      387529      382601      378157
## # … with 321 more variables: X2020.12.07 &lt;int&gt;,
## #   X2020.12.06 &lt;int&gt;, X2020.12.05 &lt;int&gt;,
## #   X2020.12.04 &lt;int&gt;, X2020.12.03 &lt;int&gt;,
## #   X2020.12.02 &lt;int&gt;, X2020.12.01 &lt;int&gt;,
## #   X2020.11.30 &lt;int&gt;, X2020.11.29 &lt;int&gt;,
## #   X2020.11.28 &lt;int&gt;, X2020.11.27 &lt;int&gt;,
## #   X2020.11.26 &lt;int&gt;, X2020.11.25 &lt;int&gt;,
## #   X2020.11.24 &lt;int&gt;, X2020.11.23 &lt;int&gt;,
## #   X2020.11.22 &lt;int&gt;, X2020.11.21 &lt;int&gt;,
## #   X2020.11.20 &lt;int&gt;, X2020.11.19 &lt;int&gt;,
## #   X2020.11.18 &lt;int&gt;, X2020.11.17 &lt;int&gt;,
## #   X2020.11.16 &lt;int&gt;, X2020.11.15 &lt;int&gt;,
## #   X2020.11.14 &lt;int&gt;, X2020.11.13 &lt;int&gt;,
## #   X2020.11.12 &lt;int&gt;, X2020.11.11 &lt;int&gt;,
## #   X2020.11.10 &lt;int&gt;, X2020.11.09 &lt;int&gt;,
## #   X2020.11.08 &lt;int&gt;, X2020.11.07 &lt;int&gt;,
## #   X2020.11.06 &lt;int&gt;, X2020.11.05 &lt;int&gt;,
## #   X2020.11.04 &lt;int&gt;, X2020.11.03 &lt;int&gt;,
## #   X2020.11.02 &lt;int&gt;, X2020.11.01 &lt;int&gt;,
## #   X2020.10.31 &lt;int&gt;, X2020.10.30 &lt;int&gt;,
## #   X2020.10.29 &lt;int&gt;, X2020.10.28 &lt;int&gt;,
## #   X2020.10.27 &lt;int&gt;, X2020.10.26 &lt;int&gt;,
## #   X2020.10.25 &lt;int&gt;, X2020.10.24 &lt;int&gt;,
## #   X2020.10.23 &lt;int&gt;, X2020.10.22 &lt;int&gt;,
## #   X2020.10.21 &lt;int&gt;, X2020.10.20 &lt;int&gt;,
## #   X2020.10.19 &lt;int&gt;, X2020.10.18 &lt;int&gt;,
## #   X2020.10.17 &lt;int&gt;, X2020.10.16 &lt;int&gt;,
## #   X2020.10.15 &lt;int&gt;, X2020.10.14 &lt;int&gt;,
## #   X2020.10.13 &lt;int&gt;, X2020.10.12 &lt;int&gt;,
## #   X2020.10.11 &lt;int&gt;, X2020.10.10 &lt;int&gt;,
## #   X2020.10.09 &lt;int&gt;, X2020.10.08 &lt;int&gt;,
## #   X2020.10.07 &lt;int&gt;, X2020.10.06 &lt;int&gt;,
## #   X2020.10.05 &lt;int&gt;, X2020.10.04 &lt;int&gt;,
## #   X2020.10.03 &lt;int&gt;, X2020.10.02 &lt;int&gt;,
## #   X2020.10.01 &lt;int&gt;, X2020.09.30 &lt;int&gt;,
## #   X2020.09.29 &lt;int&gt;, X2020.09.28 &lt;int&gt;,
## #   X2020.09.27 &lt;int&gt;, X2020.09.26 &lt;int&gt;,
## #   X2020.09.25 &lt;int&gt;, X2020.09.24 &lt;int&gt;,
## #   X2020.09.23 &lt;int&gt;, X2020.09.22 &lt;int&gt;,
## #   X2020.09.21 &lt;int&gt;, X2020.09.20 &lt;int&gt;,
## #   X2020.09.19 &lt;int&gt;, X2020.09.18 &lt;int&gt;,
## #   X2020.09.17 &lt;int&gt;, X2020.09.16 &lt;int&gt;,
## #   X2020.09.15 &lt;int&gt;, X2020.09.14 &lt;int&gt;,
## #   X2020.09.13 &lt;int&gt;, X2020.09.12 &lt;int&gt;,
## #   X2020.09.11 &lt;int&gt;, X2020.09.10 &lt;int&gt;,
## #   X2020.09.09 &lt;int&gt;, X2020.09.08 &lt;int&gt;,
## #   X2020.09.07 &lt;int&gt;, X2020.09.06 &lt;int&gt;,
## #   X2020.09.05 &lt;int&gt;, X2020.09.04 &lt;int&gt;,
## #   X2020.09.03 &lt;int&gt;, X2020.09.02 &lt;int&gt;,
## #   X2020.09.01 &lt;int&gt;, X2020.08.31 &lt;int&gt;,
## #   X2020.08.30 &lt;int&gt;, …</code></pre>
<p>or we can use <code>summarise_if()</code>, which affects variables selected with a predicate function:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb251-1"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb251-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb251-2"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb251-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb251-3"></a><span class="st">  </span><span class="kw">summarize_if</span>(is.numeric, <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </span>
<span id="cb251-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb251-4"></a></span>
<span id="cb251-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb251-5"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 327
##   State    ID X2020.12.11 X2020.12.10 X2020.12.09
##   &lt;fct&gt; &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Alab… 71489      288775      284922      280187
## 2 Ariz… 60208      394512      387529      382601
## # … with 322 more variables: X2020.12.08 &lt;int&gt;,
## #   X2020.12.07 &lt;int&gt;, X2020.12.06 &lt;int&gt;,
## #   X2020.12.05 &lt;int&gt;, X2020.12.04 &lt;int&gt;,
## #   X2020.12.03 &lt;int&gt;, X2020.12.02 &lt;int&gt;,
## #   X2020.12.01 &lt;int&gt;, X2020.11.30 &lt;int&gt;,
## #   X2020.11.29 &lt;int&gt;, X2020.11.28 &lt;int&gt;,
## #   X2020.11.27 &lt;int&gt;, X2020.11.26 &lt;int&gt;,
## #   X2020.11.25 &lt;int&gt;, X2020.11.24 &lt;int&gt;,
## #   X2020.11.23 &lt;int&gt;, X2020.11.22 &lt;int&gt;,
## #   X2020.11.21 &lt;int&gt;, X2020.11.20 &lt;int&gt;,
## #   X2020.11.19 &lt;int&gt;, X2020.11.18 &lt;int&gt;,
## #   X2020.11.17 &lt;int&gt;, X2020.11.16 &lt;int&gt;,
## #   X2020.11.15 &lt;int&gt;, X2020.11.14 &lt;int&gt;,
## #   X2020.11.13 &lt;int&gt;, X2020.11.12 &lt;int&gt;,
## #   X2020.11.11 &lt;int&gt;, X2020.11.10 &lt;int&gt;,
## #   X2020.11.09 &lt;int&gt;, X2020.11.08 &lt;int&gt;,
## #   X2020.11.07 &lt;int&gt;, X2020.11.06 &lt;int&gt;,
## #   X2020.11.05 &lt;int&gt;, X2020.11.04 &lt;int&gt;,
## #   X2020.11.03 &lt;int&gt;, X2020.11.02 &lt;int&gt;,
## #   X2020.11.01 &lt;int&gt;, X2020.10.31 &lt;int&gt;,
## #   X2020.10.30 &lt;int&gt;, X2020.10.29 &lt;int&gt;,
## #   X2020.10.28 &lt;int&gt;, X2020.10.27 &lt;int&gt;,
## #   X2020.10.26 &lt;int&gt;, X2020.10.25 &lt;int&gt;,
## #   X2020.10.24 &lt;int&gt;, X2020.10.23 &lt;int&gt;,
## #   X2020.10.22 &lt;int&gt;, X2020.10.21 &lt;int&gt;,
## #   X2020.10.20 &lt;int&gt;, X2020.10.19 &lt;int&gt;,
## #   X2020.10.18 &lt;int&gt;, X2020.10.17 &lt;int&gt;,
## #   X2020.10.16 &lt;int&gt;, X2020.10.15 &lt;int&gt;,
## #   X2020.10.14 &lt;int&gt;, X2020.10.13 &lt;int&gt;,
## #   X2020.10.12 &lt;int&gt;, X2020.10.11 &lt;int&gt;,
## #   X2020.10.10 &lt;int&gt;, X2020.10.09 &lt;int&gt;,
## #   X2020.10.08 &lt;int&gt;, X2020.10.07 &lt;int&gt;,
## #   X2020.10.06 &lt;int&gt;, X2020.10.05 &lt;int&gt;,
## #   X2020.10.04 &lt;int&gt;, X2020.10.03 &lt;int&gt;,
## #   X2020.10.02 &lt;int&gt;, X2020.10.01 &lt;int&gt;,
## #   X2020.09.30 &lt;int&gt;, X2020.09.29 &lt;int&gt;,
## #   X2020.09.28 &lt;int&gt;, X2020.09.27 &lt;int&gt;,
## #   X2020.09.26 &lt;int&gt;, X2020.09.25 &lt;int&gt;,
## #   X2020.09.24 &lt;int&gt;, X2020.09.23 &lt;int&gt;,
## #   X2020.09.22 &lt;int&gt;, X2020.09.21 &lt;int&gt;,
## #   X2020.09.20 &lt;int&gt;, X2020.09.19 &lt;int&gt;,
## #   X2020.09.18 &lt;int&gt;, X2020.09.17 &lt;int&gt;,
## #   X2020.09.16 &lt;int&gt;, X2020.09.15 &lt;int&gt;,
## #   X2020.09.14 &lt;int&gt;, X2020.09.13 &lt;int&gt;,
## #   X2020.09.12 &lt;int&gt;, X2020.09.11 &lt;int&gt;,
## #   X2020.09.10 &lt;int&gt;, X2020.09.09 &lt;int&gt;,
## #   X2020.09.08 &lt;int&gt;, X2020.09.07 &lt;int&gt;,
## #   X2020.09.06 &lt;int&gt;, X2020.09.05 &lt;int&gt;,
## #   X2020.09.04 &lt;int&gt;, X2020.09.03 &lt;int&gt;,
## #   X2020.09.02 &lt;int&gt;, X2020.09.01 &lt;int&gt;,
## #   X2020.08.31 &lt;int&gt;, …</code></pre>
<p>It is sometimes useful to rearrange the result of a query to inspect the values. For instance, we can sort on <code>X2020.12.11</code> to put the group with the largest cumulative infected count first:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb253-1"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb253-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb253-2"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb253-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb253-3"></a><span class="st">  </span><span class="kw">summarize_if</span>(is.numeric, <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb253-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb253-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(X2020.<span class="fl">12.11</span>))</span>
<span id="cb253-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb253-5"></a></span>
<span id="cb253-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb253-6"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 327
##   State     ID X2020.12.11 X2020.12.10 X2020.12.09
##   &lt;fct&gt;  &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Cali… 3.51e5     1516215     1482551     1448987
## 2 Texas 1.23e7     1388909     1374143     1359740
## # … with 322 more variables: X2020.12.08 &lt;int&gt;,
## #   X2020.12.07 &lt;int&gt;, X2020.12.06 &lt;int&gt;,
## #   X2020.12.05 &lt;int&gt;, X2020.12.04 &lt;int&gt;,
## #   X2020.12.03 &lt;int&gt;, X2020.12.02 &lt;int&gt;,
## #   X2020.12.01 &lt;int&gt;, X2020.11.30 &lt;int&gt;,
## #   X2020.11.29 &lt;int&gt;, X2020.11.28 &lt;int&gt;,
## #   X2020.11.27 &lt;int&gt;, X2020.11.26 &lt;int&gt;,
## #   X2020.11.25 &lt;int&gt;, X2020.11.24 &lt;int&gt;,
## #   X2020.11.23 &lt;int&gt;, X2020.11.22 &lt;int&gt;,
## #   X2020.11.21 &lt;int&gt;, X2020.11.20 &lt;int&gt;,
## #   X2020.11.19 &lt;int&gt;, X2020.11.18 &lt;int&gt;,
## #   X2020.11.17 &lt;int&gt;, X2020.11.16 &lt;int&gt;,
## #   X2020.11.15 &lt;int&gt;, X2020.11.14 &lt;int&gt;,
## #   X2020.11.13 &lt;int&gt;, X2020.11.12 &lt;int&gt;,
## #   X2020.11.11 &lt;int&gt;, X2020.11.10 &lt;int&gt;,
## #   X2020.11.09 &lt;int&gt;, X2020.11.08 &lt;int&gt;,
## #   X2020.11.07 &lt;int&gt;, X2020.11.06 &lt;int&gt;,
## #   X2020.11.05 &lt;int&gt;, X2020.11.04 &lt;int&gt;,
## #   X2020.11.03 &lt;int&gt;, X2020.11.02 &lt;int&gt;,
## #   X2020.11.01 &lt;int&gt;, X2020.10.31 &lt;int&gt;,
## #   X2020.10.30 &lt;int&gt;, X2020.10.29 &lt;int&gt;,
## #   X2020.10.28 &lt;int&gt;, X2020.10.27 &lt;int&gt;,
## #   X2020.10.26 &lt;int&gt;, X2020.10.25 &lt;int&gt;,
## #   X2020.10.24 &lt;int&gt;, X2020.10.23 &lt;int&gt;,
## #   X2020.10.22 &lt;int&gt;, X2020.10.21 &lt;int&gt;,
## #   X2020.10.20 &lt;int&gt;, X2020.10.19 &lt;int&gt;,
## #   X2020.10.18 &lt;int&gt;, X2020.10.17 &lt;int&gt;,
## #   X2020.10.16 &lt;int&gt;, X2020.10.15 &lt;int&gt;,
## #   X2020.10.14 &lt;int&gt;, X2020.10.13 &lt;int&gt;,
## #   X2020.10.12 &lt;int&gt;, X2020.10.11 &lt;int&gt;,
## #   X2020.10.10 &lt;int&gt;, X2020.10.09 &lt;int&gt;,
## #   X2020.10.08 &lt;int&gt;, X2020.10.07 &lt;int&gt;,
## #   X2020.10.06 &lt;int&gt;, X2020.10.05 &lt;int&gt;,
## #   X2020.10.04 &lt;int&gt;, X2020.10.03 &lt;int&gt;,
## #   X2020.10.02 &lt;int&gt;, X2020.10.01 &lt;int&gt;,
## #   X2020.09.30 &lt;int&gt;, X2020.09.29 &lt;int&gt;,
## #   X2020.09.28 &lt;int&gt;, X2020.09.27 &lt;int&gt;,
## #   X2020.09.26 &lt;int&gt;, X2020.09.25 &lt;int&gt;,
## #   X2020.09.24 &lt;int&gt;, X2020.09.23 &lt;int&gt;,
## #   X2020.09.22 &lt;int&gt;, X2020.09.21 &lt;int&gt;,
## #   X2020.09.20 &lt;int&gt;, X2020.09.19 &lt;int&gt;,
## #   X2020.09.18 &lt;int&gt;, X2020.09.17 &lt;int&gt;,
## #   X2020.09.16 &lt;int&gt;, X2020.09.15 &lt;int&gt;,
## #   X2020.09.14 &lt;int&gt;, X2020.09.13 &lt;int&gt;,
## #   X2020.09.12 &lt;int&gt;, X2020.09.11 &lt;int&gt;,
## #   X2020.09.10 &lt;int&gt;, X2020.09.09 &lt;int&gt;,
## #   X2020.09.08 &lt;int&gt;, X2020.09.07 &lt;int&gt;,
## #   X2020.09.06 &lt;int&gt;, X2020.09.05 &lt;int&gt;,
## #   X2020.09.04 &lt;int&gt;, X2020.09.03 &lt;int&gt;,
## #   X2020.09.02 &lt;int&gt;, X2020.09.01 &lt;int&gt;,
## #   X2020.08.31 &lt;int&gt;, …</code></pre>
</div>
<div id="joins-with-dplyr" class="section level2">
<h2><span class="header-section-number">8.7</span> Joins with <code>dplyr</code></h2>
<p>R has a number of quick, elegant ways to join data frames by a common column. There are at least three ways:</p>
<ul>
<li>Base R’s <code>merge()</code> function,</li>
<li>Join family of functions from <code>dplyr</code>, and</li>
<li>Bracket syntax based on <code>data.table</code>.</li>
</ul>
<p><code>dplyr</code> uses SQL database syntax for its join functions. For example, a <strong>left join</strong> means: Include everything on the left and all rows that match from the right data frame. If the join columns have the same name, all you need is <code>left_join(x, y)</code>. If they don’t have the same name, you need a by argument, such as <code>left_join(x, y, by = c("df1ColName" = "df2ColName"))</code>. See an illustration in Figure <a href="data-wrangling-with-dplyr-and-tidyr.html#fig:lrjoin">8.2</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:lrjoin"></span>
<img src="figures/Left.png" alt="An illustration of left join and right join." width="30%" /><img src="figures/Right.png" alt="An illustration of left join and right join." width="30%" />
<p class="caption">
Figure 8.2: An illustration of left join and right join.
</p>
</div>
<p>Different join functions control what happens to rows that exist in one table but not the other.</p>
<ul>
<li><code>left_join</code> keeps all the entries that are present in the left (first) table and excludes any that are only in the right table.</li>
<li><code>right_join</code> keeps all the entries that are present in the right table and excludes any that are only in the left table.</li>
<li><code>inner_join</code> keeps only the entries that are present in both tables. <code>inner_join</code> is the only function that guarantees you won’t generate any missing entries.</li>
<li><code>full_join</code> keeps all of the entries in both tables, regardless of whether or not they appear in the other table.</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:ifjoin"></span>
<img src="figures/Inner.png" alt="An illustration of inner join and full join." width="30%" /><img src="figures/Full.png" alt="An illustration of inner join and full join." width="30%" />
<p class="caption">
Figure 8.3: An illustration of inner join and full join.
</p>
</div>
<p>The join functions are nicely illustrated in RStudio’s [Data wrangling cheatsheet][<a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>].</p>
<p><code>{r join, out.width = "80%", echo=FALSE, fig.align = "center",  fig.cap="An illustration of the join functions in RStudio’s Data wrangling cheatsheet."} knitr::include_graphics("figures/dplyr-joins.png")</code></p>
<p><strong>Toy examples with joins</strong></p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-1"></a><span class="kw">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb255-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-2"></a>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">key=</span> LETTERS[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">5</span>)], </span>
<span id="cb255-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-3"></a>                <span class="dt">value1 =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">4</span>), </span>
<span id="cb255-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-4"></a>                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb255-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-5"></a>y &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">key=</span> LETTERS[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)], </span>
<span id="cb255-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-6"></a>                <span class="dt">value2 =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">4</span>), </span>
<span id="cb255-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-7"></a>                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb255-8"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-8"></a></span>
<span id="cb255-9"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-9"></a>x</span>
<span id="cb255-10"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-10"></a><span class="co">##   key value1</span></span>
<span id="cb255-11"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-11"></a><span class="co">## 1   A      3</span></span>
<span id="cb255-12"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-12"></a><span class="co">## 2   B      8</span></span>
<span id="cb255-13"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-13"></a><span class="co">## 3   C      2</span></span>
<span id="cb255-14"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-14"></a><span class="co">## 4   E      5</span></span>
<span id="cb255-15"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-15"></a>y</span>
<span id="cb255-16"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-16"></a><span class="co">##   key value2</span></span>
<span id="cb255-17"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-17"></a><span class="co">## 1   A      8</span></span>
<span id="cb255-18"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-18"></a><span class="co">## 2   B      2</span></span>
<span id="cb255-19"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-19"></a><span class="co">## 3   C      6</span></span>
<span id="cb255-20"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb255-20"></a><span class="co">## 4   D      3</span></span></code></pre></div>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb256-1"></a><span class="co"># What&#39;s in both x and y?</span></span>
<span id="cb256-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb256-2"></a><span class="kw">inner_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</span>
<span id="cb256-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb256-3"></a><span class="co">##   key value1 value2</span></span>
<span id="cb256-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb256-4"></a><span class="co">## 1   A      3      8</span></span>
<span id="cb256-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb256-5"></a><span class="co">## 2   B      8      2</span></span>
<span id="cb256-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb256-6"></a><span class="co">## 3   C      2      6</span></span></code></pre></div>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb257-1"></a><span class="co"># What&#39;s in X and bring with it the stuff that matches in Y</span></span>
<span id="cb257-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb257-2"></a><span class="kw">left_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</span>
<span id="cb257-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb257-3"></a><span class="co">##   key value1 value2</span></span>
<span id="cb257-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb257-4"></a><span class="co">## 1   A      3      8</span></span>
<span id="cb257-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb257-5"></a><span class="co">## 2   B      8      2</span></span>
<span id="cb257-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb257-6"></a><span class="co">## 3   C      2      6</span></span>
<span id="cb257-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb257-7"></a><span class="co">## 4   E      5     NA</span></span></code></pre></div>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb258-1"></a><span class="co"># What&#39;s in Y and bring with it the stuff that matches in Y</span></span>
<span id="cb258-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb258-2"></a><span class="kw">right_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</span>
<span id="cb258-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb258-3"></a><span class="co">##   key value1 value2</span></span>
<span id="cb258-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb258-4"></a><span class="co">## 1   A      3      8</span></span>
<span id="cb258-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb258-5"></a><span class="co">## 2   B      8      2</span></span>
<span id="cb258-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb258-6"></a><span class="co">## 3   C      2      6</span></span>
<span id="cb258-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb258-7"></a><span class="co">## 4   D     NA      3</span></span></code></pre></div>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-1"></a><span class="co"># Give me everything!</span></span>
<span id="cb259-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-2"></a><span class="kw">full_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</span>
<span id="cb259-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-3"></a><span class="co">##   key value1 value2</span></span>
<span id="cb259-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-4"></a><span class="co">## 1   A      3      8</span></span>
<span id="cb259-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-5"></a><span class="co">## 2   B      8      2</span></span>
<span id="cb259-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-6"></a><span class="co">## 3   C      2      6</span></span>
<span id="cb259-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-7"></a><span class="co">## 4   E      5     NA</span></span>
<span id="cb259-8"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb259-8"></a><span class="co">## 5   D     NA      3</span></span></code></pre></div>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb260-1"></a><span class="co"># Give me the stuff in X that is not in Y</span></span>
<span id="cb260-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb260-2"></a><span class="kw">anti_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</span>
<span id="cb260-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb260-3"></a><span class="co">##   key value1</span></span>
<span id="cb260-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb260-4"></a><span class="co">## 1   E      5</span></span></code></pre></div>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb261-1"></a><span class="co"># Want everything that doesn&#39;t match?</span></span>
<span id="cb261-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb261-2"></a><span class="kw">full_join</span>(<span class="kw">anti_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>), <span class="kw">anti_join</span>(y, x, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>), <span class="dt">by=</span> <span class="st">&quot;key&quot;</span>)</span>
<span id="cb261-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb261-3"></a><span class="co">##   key value1 value2</span></span>
<span id="cb261-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb261-4"></a><span class="co">## 1   E      5     NA</span></span>
<span id="cb261-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb261-5"></a><span class="co">## 2   D     NA      3</span></span></code></pre></div>
<p><strong>Practice with joins for real data</strong></p>
<p>We first get the data named <code>pop.county</code> from the github R package <code>slid</code>. Note that there are four variables in this data: <code>ID</code>, <code>County</code>, <code>State</code>, <code>population</code>.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb262-1"></a><span class="kw">library</span>(slid)</span>
<span id="cb262-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb262-2"></a><span class="kw">data</span>(I.county)</span>
<span id="cb262-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb262-3"></a><span class="kw">dim</span>(I.county)</span>
<span id="cb262-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb262-4"></a><span class="co">## [1] 3104  328</span></span>
<span id="cb262-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb262-5"></a><span class="kw">data</span>(pop.county)</span>
<span id="cb262-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb262-6"></a><span class="kw">dim</span>(pop.county)</span>
<span id="cb262-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb262-7"></a><span class="co">## [1] 3142    4</span></span></code></pre></div>
<p>Now, we would like to join the two tables: <code>I.county</code> and <code>pop.county</code> using the <code>left_join</code> as follows:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb263-1"></a>I.county.w.pop &lt;-<span class="st"> </span><span class="kw">left_join</span>(I.county, pop.county, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb263-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb263-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(<span class="st">&quot;County.y&quot;</span>, <span class="st">&quot;State.y&quot;</span>))</span></code></pre></div>
<p>or we can:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb264-1"></a>I.county.w.pop &lt;-<span class="st"> </span><span class="kw">left_join</span>(I.county, </span>
<span id="cb264-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb264-2"></a>dplyr<span class="op">::</span><span class="kw">select</span>(pop.county, <span class="kw">c</span>(ID,population)), <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
</div>
<div id="reshaping-data---change-the-layout-of-a-data-set" class="section level2">
<h2><span class="header-section-number">8.8</span> Reshaping Data - Change the layout of a data set</h2>
<p>Sometimes, we want to convert data from a wide format to a long format. Many functions in R expect data to be in a long format rather than a wide format. Programs like SPSS, however, often use wide-formatted data. There are two sets of methods that are explained below:</p>
<ul>
<li><p><code>gather()</code> and <code>spread()</code> from the <code>tidyr</code> package. This is a newer interface to the <code>reshape2</code> package.</p></li>
<li><p><code>melt()</code> and <code>dcast()</code> from the <code>reshape2</code> package.</p></li>
</ul>
<p>Many other methods aren’t covered here since they are not as easy to use.</p>
<div id="from-wide-to-long" class="section level3">
<h3><span class="header-section-number">8.8.1</span> From wide to long</h3>
<p>Below we would like to change the data <code>I.state</code> from wide format to long format.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb265-1"></a><span class="kw">library</span>(slid)</span>
<span id="cb265-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb265-2"></a><span class="kw">data</span>(I.state)</span>
<span id="cb265-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb265-3"></a><span class="kw">names</span>(I.state)</span></code></pre></div>
<p><strong>Use <code>gather(data, key, value, …)</code></strong></p>
<ul>
<li><code>data</code> = the dataframe you want to morph from wide to long</li>
<li><code>key</code> = the name of the new column that is levels of what is represented in the wide format as many columns</li>
<li><code>value</code> = the name of the column that will contain the values</li>
<li><code>…</code> = columns to gather, or leave (use -column to gather all except that one)</li>
</ul>
<p>The <code>gather</code> functions are nicely illustrated in RStudio’s [Data wrangling cheatsheet][<a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>] as shown in Figure <a href="data-wrangling-with-dplyr-and-tidyr.html#fig:gather">8.4</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:gather"></span>
<img src="figures/gather.png" alt="An illustration of `gather` function." width="50%" />
<p class="caption">
Figure 8.4: An illustration of <code>gather</code> function.
</p>
</div>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb266-1"></a>I.state.wide &lt;-<span class="st"> </span>I.state <span class="op">%&gt;%</span></span>
<span id="cb266-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb266-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(State,X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>)</span>
<span id="cb266-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb266-3"></a><span class="kw">dim</span>(I.state.wide)  </span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb268-1"></a>I.state.long &lt;-<span class="st"> </span><span class="kw">gather</span>(I.state.wide, DATE, Death, </span>
<span id="cb268-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb268-2"></a>X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>, <span class="dt">factor_key =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb268-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb268-3"></a><span class="st">                       </span><span class="kw">arrange</span>(State)</span>
<span id="cb268-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb268-4"></a><span class="kw">dim</span>(I.state.long)</span></code></pre></div>
<pre><code>## [1] 15925     3</code></pre>
<p><strong>Use <code>pivot_longer()</code></strong></p>
<p>The function <code>pivot_longer()</code> is an updated approach to <code>gather()</code>, designed to be both simpler to use and to handle more use cases. It is recommended to use <code>pivot_longer()</code> for new code; <code>gather()</code> isn’t going away but is no longer under active development.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb270-1"></a>I.state.wide &lt;-<span class="st"> </span>I.state <span class="op">%&gt;%</span></span>
<span id="cb270-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb270-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(State,X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>)</span>
<span id="cb270-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb270-3"></a><span class="kw">dim</span>(I.state.wide) </span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb272-1"></a>I.state.long &lt;-<span class="st"> </span>I.state.wide <span class="op">%&gt;%</span></span>
<span id="cb272-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb272-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>, </span>
<span id="cb272-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb272-3"></a>  <span class="dt">names_to =</span> <span class="st">&quot;DATE&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Death&quot;</span>)</span></code></pre></div>
<p>See more complicated examples from the <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">introduction of ‘tidyr’ package</a>.</p>
</div>
<div id="from-long-to-wide" class="section level3">
<h3><span class="header-section-number">8.8.2</span> From long to wide</h3>
<p>Now let’s change the data back to the wide format, and we can use <code>spread</code>.</p>
<p><strong>Use <code>Use spread(data, key, value)</code></strong></p>
<ul>
<li><code>data</code> = the dataframe you want to morph from long to wide</li>
<li><code>key</code> = the name of the column that contains the key</li>
<li><code>value</code> = the name of the column contains the values</li>
</ul>
<p>The <code>spread</code> functions are nicely illustrated in RStudio’s [Data wrangling cheatsheet][<a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>] as shown in Figure <a href="data-wrangling-with-dplyr-and-tidyr.html#fig:spread">8.5</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:spread"></span>
<img src="figures/spread.png" alt="An illustration of `spread` function." width="50%" />
<p class="caption">
Figure 8.5: An illustration of <code>spread</code> function.
</p>
</div>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb273-1"></a>I.state.wide &lt;-<span class="st"> </span><span class="kw">spread</span>(I.state.long, DATE, Death)</span>
<span id="cb273-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb273-2"></a><span class="kw">dim</span>(I.state.wide)</span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<p><strong>Use <code>pivot_wider()</code></strong></p>
<p>We can also use the function <code>pivot_wider()</code>, which “widens” data, increasing the number of columns and decreasing the number of rows. The inverse transformation is <code>pivot_longer()</code>.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb275-1"></a>I.state.wide &lt;-<span class="st"> </span>I.state.long <span class="op">%&gt;%</span></span>
<span id="cb275-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb275-2"></a><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> DATE, <span class="dt">values_from =</span> Death)</span>
<span id="cb275-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb275-3"></a><span class="kw">dim</span>(I.state.wide)</span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<p>See more complicated examples from the <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">introduction of ‘tidyr’ package</a>.</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">8.9</span> Exercises</h2>
<p>We are going to explore the basic data manipulation verbs of <code>dplyr</code> using
<code>nycflights13::flights</code>. Install the R package <code>nycflights13</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb277-1"></a><span class="kw">library</span>(nycflights13)</span>
<span id="cb277-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb277-2"></a><span class="kw">data</span>(flights)</span>
<span id="cb277-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb277-3"></a><span class="kw">names</span>(flights)</span></code></pre></div>
<pre><code>##  [1] &quot;year&quot;           &quot;month&quot;          &quot;day&quot;           
##  [4] &quot;dep_time&quot;       &quot;sched_dep_time&quot; &quot;dep_delay&quot;     
##  [7] &quot;arr_time&quot;       &quot;sched_arr_time&quot; &quot;arr_delay&quot;     
## [10] &quot;carrier&quot;        &quot;flight&quot;         &quot;tailnum&quot;       
## [13] &quot;origin&quot;         &quot;dest&quot;           &quot;air_time&quot;      
## [16] &quot;distance&quot;       &quot;hour&quot;           &quot;minute&quot;        
## [19] &quot;time_hour&quot;</code></pre>
<p>Next, use <code>?flights</code> to see more detailed information about this dataset.</p>
<ol style="list-style-type: decimal">
<li>Select <code>dep_time</code>, <code>dep_delay</code>, <code>arr_time</code>, and <code>arr_delay</code> from flights.</li>
<li>Find all flights on January 1st.</li>
<li>Find all flights that departed in December.</li>
<li>Find all flights that flew to Houston.</li>
<li>Find all flights that were operated by United, American, or Delta.</li>
<li>Sort flights to find the most delayed flights. Find the flights that left earliest.</li>
<li>What does the following code provide?</li>
</ol>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb279-1"></a>delays &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb279-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb279-2"></a><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb279-3"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb279-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb279-4"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb279-4"></a>    <span class="dt">count =</span> <span class="kw">n</span>(),</span>
<span id="cb279-5"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb279-5"></a>    <span class="dt">dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb279-6"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb279-6"></a>    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb279-7"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb279-7"></a>  )</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>What does the following code provide?</li>
</ol>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb280-1"></a>by_day &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)</span>
<span id="cb280-2"><a href="data-wrangling-with-dplyr-and-tidyr.html#cb280-2"></a><span class="kw">summarize</span>(by_day, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r-markdown.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced-programming-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SCA_book.pdf", "SCA_book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
